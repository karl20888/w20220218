<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>npm | 前端技术分享</title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/assets/style.fea2d2e9.css">
    <link rel="modulepreload" href="/assets/Home.25248bc3.js">
    <link rel="modulepreload" href="/assets/app.b5652be8.js">
    <link rel="modulepreload" href="/assets/npm.md.eafe3e31.lean.js">
    
    <meta name="twitter:title" content="npm | 前端技术分享">
  <meta property="og:title" content="npm | 前端技术分享">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-44060a3c><div class="sidebar-button" data-v-44060a3c><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="前端技术分享, back to home" data-v-44060a3c data-v-46e24c5a><!----> 前端技术分享</a><div class="flex-grow" data-v-44060a3c></div><div class="nav" data-v-44060a3c><!----></div><!--[--><!--]--></header><aside class="sidebar" data-v-3878e273><!----><!--[--><!--]--><ul class="sidebar-links" data-v-3878e273><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#工具">工具</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#创建-npm-包步骤">创建 NPM 包步骤</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#基础版本概念">基础版本概念</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#使用">使用</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#私有包命名">私有包命名</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#对于-npm-包源代码管理（被否决）">对于 NPM 包源代码管理（被否决）</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#整体管理流程">整体管理流程</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#源代码">源代码</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#打包">打包</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#nexus-仓库">Nexus 仓库</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-05070b2b><div class="container" data-v-05070b2b><!--[--><!--]--><div style="position:relative;" class="content" data-v-05070b2b><div><h1 id="npm-私有包" tabindex="-1">NPM 私有包 <a class="header-anchor" href="#npm-私有包" aria-hidden="true">#</a></h1><h2 id="工具" tabindex="-1">工具 <a class="header-anchor" href="#工具" aria-hidden="true">#</a></h2><ul><li>verdaccio 或 Nexus</li></ul><h2 id="创建-npm-包步骤" tabindex="-1">创建 NPM 包步骤 <a class="header-anchor" href="#创建-npm-包步骤" aria-hidden="true">#</a></h2><p>首先，新建一个目录，并执行命令 <code>npm init</code>。</p><p>下面根据命令行提示输入 package 基本信息。</p><p>完成之后目录下会自动生成一个 package.json 文件（当然我们也可以手动书写一份这个文件）。例如我们包名称定义为 <code>hello-npm</code>，主文件为 <code>index.js</code>，package.json 文件或许是这个样子的：</p><div class="language-json"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hello-npm&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hello NPM&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里的配置项 <code>main</code> 设置的就是主文件，这里是 <code>index.js</code>，注意，一个 package 直接指定一个主文件，或者可以理解为 main 文件，比如这个 package 要输出一个函数，那我们下面就在这个目录下新建一个 <code>index.js</code> 文件，文件内容如下：</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">helloNPM</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;Hello NPM!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>准备好文件之后，我们再执行 <code>npm publish</code> 命令，那么这个 package 就被发布出去了。</p><p>这就是发布一个 npm 包最简单的一个例子。</p><h2 id="基础版本概念" tabindex="-1">基础版本概念 <a class="header-anchor" href="#基础版本概念" aria-hidden="true">#</a></h2><p>上面我们看到 package.json 文件中的 <code>version</code> 配置项中的版本号设定为 <code>1.0.0</code>，那么我们再次修改 npm 包后，要把 <code>version</code> 增高。</p><p>我们先来看现在 NPM 管理界面的样子。</p><p><img src="/assets/1.c47bcdfb.png" alt=""></p><p>这个界面并不友好，提示没有 README 数据，那么我们就来加一下，新建一个 <a href="http://README.md" target="_blank" rel="noopener noreferrer">README.md</a> 文件，里面随便写点内容。</p><div class="language-md"><pre><code><span class="token title important">Hello NPM
<span class="token punctuation">==========</span></span>

<span class="token title important">介绍
<span class="token punctuation">----------</span></span>

这是一个演示界面。

<span class="token title important">当前版本
<span class="token punctuation">----------</span></span>

1.0.1
</code></pre></div><p>然后我们把 package.json 中的 <code>version</code> 值修改为 <code>1.0.1</code>（当然更多情况会使用 <code>npm version patch</code> 命令）。然后重新执行 <code>npm publish</code>。</p><p>发布成功后我们刷新 NPM 管理界面，这个页面就有了个亲切的 README 信息展示了。</p><p><img src="/assets/2.d2cb4656.png" alt=""></p><p>接下来我们再随便修改些内容，然后发布一个 beta 版本，我们把之前的 <code>index.js</code> 文件内容修改为：</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>下面我们来通过命令去修改版本号，执行 <code>npm version prerelease</code>。执行后我们会看到 package.json 文件中的 <code>version</code> 值自动变为了 <code>1.0.2-0</code>。</p><p><img src="/assets/3.db01928c.png" alt=""></p><p>然后我们再执行 <code>npm publish --tag beta</code>。然后我们刷新 NPM 管理页面，其实并看不出什么变化。</p><p><img src="/assets/2.d2cb4656.png" alt=""></p><p>奇怪了，刚才发布的 beta 版本去哪了？其实，我们可以切换到“版本”标签页就可以看到。</p><p><img src="/assets/4.837a0825.png" alt=""></p><p>我们再次修改 <code>index.js</code> 文件，因为在这个文件中使用了 ES6 语法，真正发布这个包的时候是要把它编译成 ES2015 的。</p><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> reverse<span class="token punctuation">;</span>
</code></pre></div><p>这时候就可以直接使用 <code>npm version patch</code> 命令来让版本好自动更新为 <code>1.0.2</code> 了，然后再通过 <code>npm publish</code> 来发布出去。</p><p>这些就是 NPM 版本的最基本的概念，当然我们还可以参阅<a href="https://www.jianshu.com/p/91902bae5572" target="_blank" rel="noopener noreferrer">其他文档</a>去处理一些特殊事情，比如错误地发布了一个版本。</p><h2 id="使用" tabindex="-1">使用 <a class="header-anchor" href="#使用" aria-hidden="true">#</a></h2><p>以上的简单演示内容都是在 NPM 私服上操作的。要使用 NPM 私服，首先要修改 npm 源地址，比如当前私服的地址是 <code>http://172.16.176.132:4873/</code>，那我们可以通过以下命令来修改源地址。</p><div class="language-bash"><pre><code><span class="token comment"># npm</span>
<span class="token function">npm</span> <span class="token builtin class-name">set</span> registry http://172.16.176.132:4873/

<span class="token comment"># pnpm</span>
<span class="token function">pnpm</span> <span class="token builtin class-name">set</span> registry http://172.16.176.132:4873/

<span class="token comment"># yarn</span>
<span class="token function">yarn</span> config <span class="token builtin class-name">set</span> registry http://172.16.176.132:4873/
</code></pre></div><p>下面来演示怎么使用这个 NPM 包。</p><p>可以看到在 NPM 管理界面的右侧就已经提供了如何安装这个 NPM 包的方法，当然网上更多的开源包都在 README 的前部位置也做好了提示。</p><p><img src="/assets/5.185cc64a.png" alt=""></p><p>随便新建一个项目。然后执行 <code>npm install hello-npm</code>。然后再新建一个 js 文件，这里加入我们新建一个 <code>index.js</code> 文件，代码如下：</p><div class="language-js"><pre><code><span class="token keyword">const</span> reverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;hello-npm&#39;</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token string">&#39;abc&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>然后执行它，这里我们已经在 package.json 文件中指定好了脚本 <code>start</code> 为 <code>node index.js</code>，所以我们直接执行 <code>npm start</code> 即可。</p><p><img src="/assets/6.69c1cd03.png" alt=""></p><h2 id="私有包命名" tabindex="-1">私有包命名 <a class="header-anchor" href="#私有包命名" aria-hidden="true">#</a></h2><p>我们把所有私有包的命名都加个前缀 <code>@dbsec</code>，通过配置文件控制带有 <code>@dbsec</code> 前缀的包仅会上传到私服，也只有在私服里可以下载到。</p><h2 id="对于-npm-包源代码管理（被否决）" tabindex="-1">对于 NPM 包源代码管理（被否决） <a class="header-anchor" href="#对于-npm-包源代码管理（被否决）" aria-hidden="true">#</a></h2><p>建议使用 Git。</p><ul><li>PR 模式</li><li>开发者提交 PR</li><li>审核人合并 PR，维护正式版本</li><li>提交发版流程</li></ul><h2 id="整体管理流程" tabindex="-1">整体管理流程 <a class="header-anchor" href="#整体管理流程" aria-hidden="true">#</a></h2><h3 id="源代码" tabindex="-1">源代码 <a class="header-anchor" href="#源代码" aria-hidden="true">#</a></h3><ul><li>申请 SVN 仓库权限</li><li>提交代码</li></ul><h3 id="打包" tabindex="-1">打包 <a class="header-anchor" href="#打包" aria-hidden="true">#</a></h3><ul><li>Jenkins 配置任务</li></ul><h3 id="nexus-仓库" tabindex="-1">Nexus 仓库 <a class="header-anchor" href="#nexus-仓库" aria-hidden="true">#</a></h3><ul><li>release 仓库（少数人有权限，前期可手动处理，后期可安排工具）</li><li>beta 仓库</li></ul><p><img src="/assets/7.d375c649.png" alt=""></p></div></div><footer class="page-footer" data-v-05070b2b data-v-4f6b8e78><div class="edit" data-v-4f6b8e78><div class="edit-link" data-v-4f6b8e78 data-v-dc577608><!----></div></div><div class="updated" data-v-4f6b8e78><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"element-plus.md\":\"540d9caf\",\"index.md\":\"cb10711c\",\"monorepo.md\":\"9444511a\",\"npm.md\":\"eafe3e31\",\"typescript.md\":\"5e3d5395\",\"vue3_composition-api.md\":\"3a186426\",\"vue3_index.md\":\"6e4a16a8\"}")</script>
    <script type="module" async src="/assets/app.b5652be8.js"></script>
    
  </body>
</html>