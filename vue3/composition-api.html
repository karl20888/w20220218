<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>意大利面代码结构吐槽 | 前端技术分享</title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/assets/style.fea2d2e9.css">
    <link rel="modulepreload" href="/assets/Home.25248bc3.js">
    <link rel="modulepreload" href="/assets/app.b5652be8.js">
    <link rel="modulepreload" href="/assets/vue3_composition-api.md.3a186426.lean.js">
    
    <meta name="twitter:title" content="意大利面代码结构吐槽 | 前端技术分享">
  <meta property="og:title" content="意大利面代码结构吐槽 | 前端技术分享">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-44060a3c><div class="sidebar-button" data-v-44060a3c><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="前端技术分享, back to home" data-v-44060a3c data-v-46e24c5a><!----> 前端技术分享</a><div class="flex-grow" data-v-44060a3c></div><div class="nav" data-v-44060a3c><!----></div><!--[--><!--]--></header><aside class="sidebar" data-v-3878e273><!----><!--[--><!--]--><ul class="sidebar-links" data-v-3878e273><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#一些吐槽">一些吐槽</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#意大利面代码结构吐槽">意大利面代码结构吐槽</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#抄袭-react-吐槽：">抄袭 React 吐槽：</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#组合式-api-设计动机">组合式 API 设计动机</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#逻辑重用">逻辑重用</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#代码组织">代码组织</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#按技术类型划分代码">按技术类型划分代码</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#过于关注逻辑复用">过于关注逻辑复用</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#尤雨溪的看法">尤雨溪的看法</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#关于抄袭-react-hook">关于抄袭 React Hook</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#扩展阅读">扩展阅读</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#更多详见">更多详见</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#总结">总结</a><!----></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-05070b2b><div class="container" data-v-05070b2b><!--[--><!--]--><div style="position:relative;" class="content" data-v-05070b2b><div><h1 id="组合式-api" tabindex="-1">组合式 API <a class="header-anchor" href="#组合式-api" aria-hidden="true">#</a></h1><h2 id="一些吐槽" tabindex="-1">一些吐槽 <a class="header-anchor" href="#一些吐槽" aria-hidden="true">#</a></h2><h3 id="意大利面代码结构吐槽" tabindex="-1">意大利面代码结构吐槽 <a class="header-anchor" href="#意大利面代码结构吐槽" aria-hidden="true">#</a></h3><blockquote><p>太失望了。杂七杂八一堆丢在 setup 里，我还不如直接用 react。</p></blockquote><blockquote><p>我的天，3.0 这么搞的话，代码结构不清晰，语义不明确，无异于把 vue 自身优点都扔了。</p></blockquote><blockquote><p>怎么感觉代码结构上没有 2.0 清晰了呢 这要是代码量上去了是不是不好维护啊？</p></blockquote><h3 id="抄袭-react-吐槽：" tabindex="-1">抄袭 React 吐槽： <a class="header-anchor" href="#抄袭-react-吐槽：" aria-hidden="true">#</a></h3><blockquote><p>抄来抄去没自己的个性。</p></blockquote><blockquote><p>有 react 香吗？越来越像 react 了</p></blockquote><h2 id="组合式-api-设计动机" tabindex="-1">组合式 API 设计动机 <a class="header-anchor" href="#组合式-api-设计动机" aria-hidden="true">#</a></h2><p>首先抛出 Vue 2 的代码模式下存在的几个问题。</p><ol><li><p>随着功能的增长，复杂组件的代码变得越来越难以维护。尤其发生你去新接手别人的代码时。根本原因是 Vue 的现有 API 通过“选项”组织代码，但在大部分情况下，通过逻辑考虑来组织代码更有意义。</p></li><li><p>缺少一种比较“干净”的在多个组件之间提取和复用逻辑的机制。</p></li><li><p>类型推断不够友好。</p></li></ol><h3 id="逻辑重用" tabindex="-1">逻辑重用 <a class="header-anchor" href="#逻辑重用" aria-hidden="true">#</a></h3><p>组件逻辑复用在 React 中经历了很长一段发展历程，mixin → HOC → Hook。</p><ul><li>mixin 是 React 中最早启用的一种逻辑复用方式，缺点实在是多到数不清。</li><li>HOC 也有着自己的问题，比如增加组件嵌套、props 来源不明确等等。</li><li>Hook 是相对完美的一种方案。</li></ul><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">MenuBar</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token comment">// props 里混合着来自各个HOC传入的属性，还有父组件传入的属性。</span>
  <span class="token function">handleClickNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> readyToReplaceProject <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">confirmReadyToReplaceProject</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>intl<span class="token punctuation">.</span><span class="token function">formatMessage</span><span class="token punctuation">(</span>sharedMessages<span class="token punctuation">.</span>replaceProjectWarning<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onRequestCloseFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>readyToReplaceProject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onClickNew</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>canSave <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>canCreateNew<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onRequestCloseFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">handleClickRemix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onClickRemix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onRequestCloseFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">handleClickSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onClickSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onRequestCloseFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">handleClickSaveAsCopy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onClickSaveAsCopy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onRequestCloseFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">compose</span><span class="token punctuation">(</span>
  <span class="token comment">// 国际化</span>
  injectIntl<span class="token punctuation">,</span>
  <span class="token comment">// 菜单</span>
  MenuBarHOC<span class="token punctuation">,</span>
  <span class="token comment">// react-redux</span>
  <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">(</span>MenuBar<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">MenuBar</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// props 里只包含父组件传入的属性</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> show <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  <span class="token comment">// 菜单</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> onClickRemix<span class="token punctuation">,</span> onClickNew <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMenuBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 国际化</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> intl <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useIntl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// react-redux</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> store<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> MenuBar<span class="token punctuation">;</span>
</code></pre></div><div class="language-vue"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>error<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>failed to load<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>loading...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else</span><span class="token punctuation">&gt;</span></span>hello {{fullName}}!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 集中式的data定义 如果有其他逻辑相关的数据就很容易混乱</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">firstName</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">lastName</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// 管理loading</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token comment">// 取数据</span>
      <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$axios</span><span class="token punctuation">(</span><span class="token string">&#39;/api/user&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 管理error</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>error <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      <span class="token comment">// 管理loading</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 没人知道这个fullName和哪一部分的异步请求有关 和哪一部分的data有关 除非仔细阅读</span>
    <span class="token comment">// 在组件大了以后更是如此</span>
    <span class="token function">fullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>lastName
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>对于 loading、error 等处理的可复用性为零。</li><li>数据和逻辑分散在各个 option 中。</li></ul><div class="language-vue"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>error<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>failed to load<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>loading...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else</span><span class="token punctuation">&gt;</span></span>hello {{fullName}}!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> createComponent<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> useSWR <span class="token keyword">from</span> <span class="token string">&#39;vue-swr&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// useSWR帮你管理好了取数、缓存、甚至标签页聚焦重新请求、甚至Suspense...</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> loading<span class="token punctuation">,</span> error <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useSWR</span><span class="token punctuation">(</span><span class="token string">&#39;/api/user&#39;</span><span class="token punctuation">,</span> fetcher<span class="token punctuation">)</span>
      <span class="token comment">// 轻松的定义计算属性</span>
      <span class="token keyword">const</span> fullName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> data<span class="token punctuation">.</span>firstName <span class="token operator">+</span> data<span class="token punctuation">.</span>lastName<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> fullName<span class="token punctuation">,</span> loading<span class="token punctuation">,</span> error <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>逻辑更加聚合。</li></ul><h3 id="代码组织" tabindex="-1">代码组织 <a class="header-anchor" href="#代码组织" aria-hidden="true">#</a></h3><p>上面说了那么多，还只是说了 Hook 的其中一个优势，这其实并不能解决“意大利面条代码”的问题。当逻辑多起来以后，组件的逻辑会糅合在一起变得一团乱麻吗？</p><h4 id="从获取鼠标位置的需求讲起" tabindex="-1">从获取鼠标位置的需求讲起 <a class="header-anchor" href="#从获取鼠标位置的需求讲起" aria-hidden="true">#</a></h4><p>我们有这样一个跨组件的需求，我想在组件里获得一个响应式的变量，能实时地指向鼠标所在的位置。</p><p>Vue 官方给出的自定义 Hook 的例子：</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> onUnmounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useMousePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>pageX<span class="token punctuation">;</span>
    y<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>pageY<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在组件中使用：</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useMousePosition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./mouse&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMousePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// other logic...</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="从-vue-官方的例子讲起" tabindex="-1">从 Vue 官方的例子讲起 <a class="header-anchor" href="#从-vue-官方的例子讲起" aria-hidden="true">#</a></h4><p>上面的例子足够入门和精简，下面让我们来到现实世界。举一个 <a href="https://github.com/vuejs/vue-cli/blob/a09407dd5b9f18ace7501ddb603b95e31d6d93c0/packages/@vue/cli-ui/src/components/folder/FolderExplorer.vue#L198-L404" target="_blank" rel="noopener noreferrer">Vue CLI UI file explorer</a> 官方吐槽的例子，这个组件是 Vue-CLI 的 GUI 中（也就是平常我们命令行里输入 <code>vue ui</code> 出来的那个图形化控制台）的一个复杂的文件浏览器组件，这是 Vue 官方团队的大佬写的，相信是比较有说服力的一个案例了。</p><p>这个组件有以下几个功能：</p><ol><li>跟踪当前文件夹状态并显示其内容。</li><li>处理文件夹导航（打开，关闭，刷新等）。</li><li>处理新文件夹的创建。</li><li>切换显示收藏夹。</li><li>切换显示隐藏文件夹。</li><li>处理当前工作目录更改。</li></ol><p>文档中提出了一个尖锐的灵魂拷问，你作为一个新接手的开发人员，能够在茫茫的 <code>method</code>、<code>data</code>、<code>computed</code> 等选项中一目了然地发现这个变量是属于哪个功能吗？比如“创新文件夹”功能使用了两个数据属性，一个计算属性一个方法，其中该方法在距数据属性“一百行以上”的位置定义。</p><p>当一个组件中，维护同一个逻辑需要跨越上百行“空间距离”的时候，即使是让我去维护 Vue 官方团队的代码，我也会暗搓搓地吐槽一句：“这写的什么玩意，这变量干嘛用的！”</p><p>尤大大很贴心地给出了一张图，在这张图上，不同的色块代表着不同的功能点。</p><p><img src="/assets/options-api.4c42b509.png" alt="Options API"></p><p>而使用 Hook 以后呢？我们可以把“新建文件夹”这个功能美美地抽到一个函数中去：</p><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">useCreateFolder</span><span class="token punctuation">(</span><span class="token parameter">openFolder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// originally data properties</span>
  <span class="token keyword">const</span> showNewFolder <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> newFolderName <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// originally computed property</span>
  <span class="token keyword">const</span> newFolderValid <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">isValidMultiName</span><span class="token punctuation">(</span>newFolderName<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// originally a method</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createFolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>newFolderValid<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">mutation</span><span class="token operator">:</span> <span class="token constant">FOLDER_CREATE</span><span class="token punctuation">,</span>
      <span class="token literal-property property">variables</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> newFolderName<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">openFolder</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>folderCreate<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newFolderName<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    showNewFolder<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    showNewFolder<span class="token punctuation">,</span>
    newFolderName<span class="token punctuation">,</span>
    newFolderValid<span class="token punctuation">,</span>
    createFolder<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们约定这些“自定义 Hook”以 <code>use</code> 作为前缀，和普通的函数加以区分。</p><p>右边用了 Hook 以后的代码组织色块：</p><p><img src="/assets/composition-api.7e45603b.png" alt="Composition API"></p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">useCurrentFolderData</span><span class="token punctuation">(</span><span class="token parameter">networkState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">useFolderNavigation</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> networkState<span class="token punctuation">,</span> currentFolderData <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">useFavoriteFolder</span><span class="token punctuation">(</span><span class="token parameter">currentFolderData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">useHiddenFolders</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">useCreateFolder</span><span class="token punctuation">(</span><span class="token parameter">openFolder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>再来看看被吐槽成“意大利面条代码”的 <code>setup</code> 函数。</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Network</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> networkState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useNetworkState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Folder</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> folders<span class="token punctuation">,</span> currentFolderData <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useCurrentFolderData</span><span class="token punctuation">(</span>networkState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> folderNavigation <span class="token operator">=</span> <span class="token function">useFolderNavigation</span><span class="token punctuation">(</span><span class="token punctuation">{</span> networkState<span class="token punctuation">,</span> currentFolderData <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> favoriteFolders<span class="token punctuation">,</span> toggleFavorite <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useFavoriteFolders</span><span class="token punctuation">(</span>currentFolderData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> showHiddenFolders <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useHiddenFolders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> createFolder <span class="token operator">=</span> <span class="token function">useCreateFolder</span><span class="token punctuation">(</span>folderNavigation<span class="token punctuation">.</span>openFolder<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Current working directory</span>
    <span class="token function">resetCwdOnLeave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> updateOnCwdChanged <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useCwdUtils</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Utils</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> slicePath <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">usePathUtils</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      networkState<span class="token punctuation">,</span>
      folders<span class="token punctuation">,</span>
      currentFolderData<span class="token punctuation">,</span>
      folderNavigation<span class="token punctuation">,</span>
      favoriteFolders<span class="token punctuation">,</span>
      toggleFavorite<span class="token punctuation">,</span>
      showHiddenFolders<span class="token punctuation">,</span>
      createFolder<span class="token punctuation">,</span>
      updateOnCwdChanged<span class="token punctuation">,</span>
      slicePath<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="按技术类型划分代码" tabindex="-1">按技术类型划分代码 <a class="header-anchor" href="#按技术类型划分代码" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">msgList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> username <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      username <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">onSendMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span> <span class="token operator">=</span> state
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>message<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span>
      state<span class="token punctuation">.</span>msgList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">user</span><span class="token operator">:</span> username<span class="token punctuation">,</span>
        <span class="token literal-property property">dateTime</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> state<span class="token punctuation">.</span>message
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      state<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span><span class="token function">toRefs</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">,</span>
      onSendMessage
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>实际上我们过于关注语法层面改变，而忽略官方文档提到一个词叫：逻辑关注点！！！！！！, 逻辑关注点是指表达同一个业务的代码内聚到一起，这也是单一职责的指导思想，我们内聚的不应该技术类型，而是业务逻辑，因为触发代码变更的往往是业务需求，因此把相同变更理由的代码放在一起，这才不会导致散弹式修改。</p><h3 id="过于关注逻辑复用" tabindex="-1">过于关注逻辑复用 <a class="header-anchor" href="#过于关注逻辑复用" aria-hidden="true">#</a></h3><p>Compostion API 一个特点是提升逻辑复用，这是没有错的，但是有一个错误观点，就是只有复用的逻辑才应该封装到hook中。</p><p>我们还是回到 Vue 的官方例子，你会发现他把原来放在一个vue文件的逻辑拆分到composables 目录，目录下分别定义一个文件，表示不同的逻辑关注点。</p><p><img src="/assets/1.d29eff1b.png" alt=""></p><p>这个文件夹的代码强调的并不是<strong>逻辑复用</strong>，而是<strong>逻辑关注点</strong>分离，这也是 Composition API 最核心要解决的问题，因为应用生命周期 60% 时间都是在维护的，而维护性体现在代码是否符合单一职责原则，单一职责就是把相同的业务代码内聚到一个地方。</p><p>所以你不要过于纠结代码是否需要复用，应用适当的冗余反而增加应用的维护性，《架构整洁之道》书中提到：<strong>对于大多数应用，可维护性可比重用性更加重要</strong>。</p><h3 id="尤雨溪的看法" tabindex="-1">尤雨溪的看法 <a class="header-anchor" href="#尤雨溪的看法" aria-hidden="true">#</a></h3><p>Composition API 在提案的时候，就有很多人持有不同的意见，有反对有支持，实际上都没有错，只是大家碰到的场景不同而导致不同观点。我们来看尤大大对一些问题的解答。</p><h4 id="composition-api-根本没有解决任何问题，只是追逐新玩意的东西" tabindex="-1">Composition API 根本没有解决任何问题，只是追逐新玩意的东西 <a class="header-anchor" href="#composition-api-根本没有解决任何问题，只是追逐新玩意的东西" aria-hidden="true">#</a></h4><p>不同意这个观点。Vue 最开始很小，但是现在被广泛应用到不同级别复杂度的业务领域，有些可以基于 Option API 很轻松处理，但是有些不可以。例如下面的场景：</p><ol><li>有很多逻辑的大型组件（数百行）</li><li>在多个组件可复用的逻辑</li></ol><p>对于问题 1，你需要把每个逻辑拆分到不同选项，例如，一段逻辑需要一些响应数据，一个计算属性，一些监听属性还有方法。你去了解这段逻辑时，需要不断上下移动阅读，虽然你知道一些属性是什么类型，但是你并不知道他具体的作用。当一个组件包含多个逻辑，情况就更糟糕了。如果用新的API，可以将数据和逻辑组合在一起，最重要的是，你可以<strong>干净的把这些逻辑提取到一个函数，甚至一个单独的文件中</strong>。</p><h4 id="使用新-api-导致逻辑分散到不同地方，违背“关注点分离”" tabindex="-1">使用新 API 导致逻辑分散到不同地方，违背“关注点分离” <a class="header-anchor" href="#使用新-api-导致逻辑分散到不同地方，违背“关注点分离”" aria-hidden="true">#</a></h4><p>这个问题和项目文件组织方式问题类似。我们很多人都同意按文件类型组织（布局放HTML，样式CSS，逻辑JS）并不是正确的方式，因为强制把相关代码分割到三个文件，只是给人一种“关注点分离”的错觉。这里的关键是“关注点”不是由文件类型定义。相反，我们大多数选择以<strong>功能或者职责</strong>来组织文件，<strong>这正是人们喜欢 Vue 单文件组件的原因</strong>。SFC 就是按功能组织代码的方法，但讽刺的是当首次引入 SFC 时，许多人也是拒绝的，认为它违反了关注点分离。</p><h4 id="新的语法让-vue-失去简单性，导致“意大利面条式代码”的出现，降低项目维护性。" tabindex="-1">新的语法让 Vue 失去简单性，导致“意大利面条式代码”的出现，降低项目维护性。 <a class="header-anchor" href="#新的语法让-vue-失去简单性，导致“意大利面条式代码”的出现，降低项目维护性。" aria-hidden="true">#</a></h4><p>正好相反，新的 API 就是为了提高项目长期维护性的。</p><p>如果我们查看任何 JavaScript 项目，都会从入口文件开始阅读，该文件的本质是你的应用启动时被隐式调用的 &quot;main&quot; 函数。如果只有一个函数入口，会导致意大利面条代码，那所有的 js 项目都是意大利面条代码。显然不是的，因为开发人员通过代码模块化或者较小的函数来组织代码。</p><p>另外，我同意新的 API 理论上会降低代码质量的最低门槛。但是我们可以使用以往防止代码变成意大利面条的手段缓解这种情况。另一方面，新的 API 可以提升代码质量的最高上限，相比 Option API，你可以重构为质量更高的代码。而且，基于 Option API 你还得解决类似 Mixins 的问题。</p><p>很多人认为“Vue 失去简单性”，实际上只是失去组件内代码类型检查能力（就是你不知道一个变量是 data、method、还是 computed）。但是用新的 API，实现一个类型检测器也是非常容易实现以前的特性的。也就是说，你不应该被 Option API 限制思维，而更多关注逻辑内聚问题。</p><h2 id="关于抄袭-react-hook" tabindex="-1">关于抄袭 React Hook <a class="header-anchor" href="#关于抄袭-react-hook" aria-hidden="true">#</a></h2><p>其实前端开源界谈抄袭也不太好，一种新的模式的出现的值得框架之间相互借鉴和学习的，毕竟框架归根结底的目的不是为了「标榜自己的特立独行」，而是「方便广大开发者」。这是值得思考的一点，很多人似乎觉得一个框架用了某种模式，另一个框架就不能用，其实这对于框架之间的进步和发展并没有什么好处。</p><p>这里直接引用尤大在 17 年回应「Vue 借鉴虚拟 dom」的一段话：</p><blockquote><p>再说 vdom。React 的 vdom 其实性能不怎么样。Vue 2.0 引入 vdom 的主要原因是 vdom 把渲染过程抽象化了，从而使得组件的抽象能力也得到提升，并且可以适配 DOM 以外的渲染目标。这一点是借鉴 React 毫无争议，因为我认为 vdom 确实是个好思想。但要分清楚的是 Vue 引入 vdom 不是因为『react 有所以我们也要有』，而是因为它确实有技术上的优越性。社区里基于 vdom 思想造的轮子海了去了，而 ng2 的渲染抽象层和 Ember Glimmer 2 的模板 -&gt; opcode 编译也跟 vdom 有很多思想上的相似性。</p></blockquote><p>这段话如今用到 Hook 上还是一样的适用，程序员都提倡开源精神，怎么到了 Vue 和 React 之间有些人又变得小气起来了呢？说的难听点，Vue 保持自己的特立独行，那你假如换了一家新公司要你用 Vue，你不是又得从头学一遍嘛。</p><p>这段话如今用到 Hook 上还是一样的适用，程序员都提倡开源精神，怎么到了 Vue 和 React 之间有些人又变得小气起来了呢？说的难听点，Vue 保持自己的特立独行，那你假如换了一家新公司要你用 Vue，你不是又得从头学一遍嘛。</p><h2 id="扩展阅读" tabindex="-1">扩展阅读 <a class="header-anchor" href="#扩展阅读" aria-hidden="true">#</a></h2><p>对于两种 Hook 之间的区别，想要进一步学习的同学还可以看黄子毅的好文：</p><p><a href="https://juejin.cn/post/6844903877574295560" target="_blank" rel="noopener noreferrer">精读《Vue3.0 Function API》</a></p><p>尤小右在官方 issue 中对于 React Hook 详细的对比看法：</p><p><a href="https://github.com/vuejs/rfcs/issues/89" target="_blank" rel="noopener noreferrer">Why remove time slicing from vue3?</a></p><h2 id="更多详见" tabindex="-1"><a href="https://zhuanlan.zhihu.com/p/133819602" target="_blank" rel="noopener noreferrer">更多详见</a> <a class="header-anchor" href="#更多详见" aria-hidden="true">#</a></h2><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-hidden="true">#</a></h2><p>对于意大利面代码：</p><ol><li>提取共用的自定义 Hook。</li><li>基于“逻辑功能”去组织代码，而不是 <code>state</code> 放在一块，<code>method</code> 放在一块，这样和用 Vue 2 没什么本质上的区别。</li></ol><p>对于心智负担：</p><ol><li>更强大的能力意味着更多的学习成本，但是 Vue 3 总体而言已经把心智负担控制得很到位了。对于 <code>ref</code> 确实需要仔细思考一下才能理解。</li><li>React Hook 的心智负担更重。</li><li>不学习怎么能升职加薪，迎娶白富美，走向人生巅峰呢！</li></ol></div></div><footer class="page-footer" data-v-05070b2b data-v-4f6b8e78><div class="edit" data-v-4f6b8e78><div class="edit-link" data-v-4f6b8e78 data-v-dc577608><!----></div></div><div class="updated" data-v-4f6b8e78><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"element-plus.md\":\"540d9caf\",\"index.md\":\"cb10711c\",\"monorepo.md\":\"9444511a\",\"npm.md\":\"eafe3e31\",\"typescript.md\":\"5e3d5395\",\"vue3_composition-api.md\":\"3a186426\",\"vue3_index.md\":\"6e4a16a8\"}")</script>
    <script type="module" async src="/assets/app.b5652be8.js"></script>
    
  </body>
</html>